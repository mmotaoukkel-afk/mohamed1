# ๐ Firestore Security Rules - Kataraa

## ุงููุฏู
ุญูุงูุฉ ุงูุจูุงูุงุช ุนูู ูุณุชูู ุงูู Backend. ุญุชู ูู ุชู ุชุฌุงูุฒ ุงููุงุฌูุฉ ุงูุฃูุงููุฉุ ูู ูุชููู ุงููุณุชุฎุฏู ูู ุงูุชูุงุนุจ ุจุงูุจูุงูุงุช.

## ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุตูุงุญูุงุช

### ุงููุณุชุฎุฏู ุงูุนุงุฏู (Customer)
| ุงููุฌููุนุฉ | ูุฑุงุกุฉ | ูุชุงุจุฉ |
|----------|-------|-------|
| products | โ | โ |
| orders | โ (ุทูุจุงุชู ููุท) | โ (ุฅูุดุงุก ููุท) |
| users | โ (ูููู ููุท) | โ (ุจุฏูู ุชุบููุฑ ุงูุฏูุฑ) |
| coupons | โ | โ |
| reviews | โ | โ (ูุฑุงุฌุนุงุชู ููุท) |

### ุงููุดุฑู (Admin)
| ุงููุฌููุนุฉ | ูุฑุงุกุฉ | ูุชุงุจุฉ |
|----------|-------|-------|
| products | โ | โ |
| orders | โ ุงููู | โ |
| users | โ ุงููู | โ (ุชุบููุฑ ุงูุฏูุฑ) |
| customers | โ | โ |
| coupons | โ | โ |
| analytics | โ | โ |
| settings | โ | โ |

### ุงููุดุฑู ุงูุฑุฆูุณู (Super Admin)
| ุงููุฌููุนุฉ | ูุฑุงุกุฉ | ูุชุงุจุฉ |
|----------|-------|-------|
| ุงููู | โ | โ |
| users (roles) | โ | โ |
| settings | โ | โ |
| adminLogs | โ | โ |

---

## ููููุฉ ุงููุดุฑ

### 1. ุชุซุจูุช Firebase CLI
```bash
npm install -g firebase-tools
```

### 2. ุชุณุฌูู ุงูุฏุฎูู
```bash
firebase login
```

### 3. ุชููุฆุฉ ุงููุดุฑูุน (ุฅุฐุง ูู ููู ูููุฃ)
```bash
firebase init firestore
```

### 4. ูุดุฑ ุงูููุงุนุฏ
```bash
firebase deploy --only firestore:rules
```

---

## ุงุฎุชุจุงุฑ ุงูููุงุนุฏ

### ุงุณุชุฎุฏุงู Emulator
```bash
firebase emulators:start
```

ุซู ุงูุชุญ: `http://localhost:4000`

### ุงุฎุชุจุงุฑ ูุฏูู
1. ุณุฌู ุงูุฏุฎูู ููุณุชุฎุฏู ุนุงุฏู
2. ุญุงูู ุชุนุฏูู ููุชุฌ โ ูุฌุจ ุฃู ููุดู
3. ุณุฌู ุงูุฏุฎูู ููุดุฑู
4. ุญุงูู ุชุนุฏูู ููุชุฌ โ ูุฌุจ ุฃู ููุฌุญ

---

## ุงูุฏูุงู ุงููุณุงุนุฏุฉ

```javascript
// ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู
function isAuthenticated() {
  return request.auth != null;
}

// ุงูุญุตูู ุนูู ุฏูุฑ ุงููุณุชุฎุฏู
function getUserRole() {
  return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role;
}

// ุงูุชุญูู ูู ุตูุงุญูุฉ ุงููุดุฑู
function hasAdminAccess() {
  return isAuthenticated() && 
         (getUserRole() == 'admin' || getUserRole() == 'super_admin');
}

// ุงูุชุญูู ูู ููููุฉ ุงููุณุชูุฏ
function isOwner(userId) {
  return request.auth.uid == userId;
}
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ูุง ุชูุณู ุฅูุดุงุก ูุณุชูุฏ ุงููุดุฑู ูู Firestore:**
   ```
   users/{uid}
   {
     "email": "admin@kataraa.com",
     "role": "admin"  // ุฃู "super_admin"
   }
   ```

2. **ุงููุงุนุฏุฉ ุงูุงูุชุฑุงุถูุฉ:**
   ุฃู ูุฌููุนุฉ ุบูุฑ ูุนุฑููุฉ = ุฑูุถ ุชููุงุฆู

3. **ุณุฌู ุงูุชุฏููู:**
   ูุฌููุนุฉ `adminLogs` ูุง ูููู ุชุนุฏูููุง ุฃู ุญุฐููุง (ููุญูุงุธ ุนูู ุณุฌู ุงููุดุงุทุงุช)

---

## ุงููุฌููุนุงุช ุงููุญููุฉ

| ุงููุฌููุนุฉ | ุงููุตู |
|----------|-------|
| `users` | ูููุงุช ุงููุณุชุฎุฏููู ูุงูุฃุฏูุงุฑ |
| `products` | ุงูููุชุฌุงุช (ูุฑุงุกุฉ ุนุงูุฉุ ูุชุงุจุฉ ูููุดุฑู) |
| `orders` | ุงูุทูุจุงุช |
| `customers` | ุฅุญุตุงุฆูุงุช ุงูุฒุจูุงุก (ูุดุฑู ููุท) |
| `coupons` | ุฃููุงุฏ ุงูุฎุตู |
| `analytics` | ุจูุงูุงุช ุงูุชุญูููุงุช |
| `settings` | ุฅุนุฏุงุฏุงุช ุงููุชุฌุฑ |
| `deliveryZones` | ููุงุทู ุงูุชูุตูู |
| `categories` | ูุฆุงุช ุงูููุชุฌุงุช |
| `reviews` | ูุฑุงุฌุนุงุช ุงูููุชุฌุงุช |
| `adminLogs` | ุณุฌู ูุดุงุทุงุช ุงููุดุฑููู |
